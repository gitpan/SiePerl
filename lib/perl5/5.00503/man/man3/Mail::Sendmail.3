.rn '' }`
''' $RCSfile$$Revision$$Date$
'''
''' $Log$
'''
.de Sh
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp
.if t .sp .5v
.if n .sp
..
.de Ip
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.de Vb
.ft CW
.nf
.ne \\$1
..
.de Ve
.ft R

.fi
..
'''
'''
'''     Set up \*(-- to give an unbreakable dash;
'''     string Tr holds user defined translation string.
'''     Bell System Logo is used as a dummy character.
'''
.tr \(*W-|\(bv\*(Tr
.ie n \{\
.ds -- \(*W-
.ds PI pi
.if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\" diablo 12 pitch
.ds L" ""
.ds R" ""
'''   \*(M", \*(S", \*(N" and \*(T" are the equivalent of
'''   \*(L" and \*(R", except that they are used on ".xx" lines,
'''   such as .IP and .SH, which do another additional levels of
'''   double-quote interpretation
.ds M" """
.ds S" """
.ds N" """""
.ds T" """""
.ds L' '
.ds R' '
.ds M' '
.ds S' '
.ds N' '
.ds T' '
'br\}
.el\{\
.ds -- \(em\|
.tr \*(Tr
.ds L" ``
.ds R" ''
.ds M" ``
.ds S" ''
.ds N" ``
.ds T" ''
.ds L' `
.ds R' '
.ds M' `
.ds S' '
.ds N' `
.ds T' '
.ds PI \(*p
'br\}
.\"	If the F register is turned on, we'll generate
.\"	index entries out stderr for the following things:
.\"		TH	Title 
.\"		SH	Header
.\"		Sh	Subsection 
.\"		Ip	Item
.\"		X<>	Xref  (embedded
.\"	Of course, you have to process the output yourself
.\"	in some meaninful fashion.
.if \nF \{
.de IX
.tm Index:\\$1\t\\n%\t"\\$2"
..
.nr % 0
.rr F
.\}
.TH Sendmail 3 "perl 5.005, patch 03" "28/Mar/1999" "User Contributed Perl Documentation"
.UC
.if n .hy 0
.if n .na
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.de CQ          \" put $1 in typewriter font
.ft CW
'if n "\c
'if t \\&\\$1\c
'if n \\&\\$1\c
'if n \&"
\\&\\$2 \\$3 \\$4 \\$5 \\$6 \\$7
'.ft R
..
.\" @(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2
.	\" AM - accent mark definitions
.bd B 3
.	\" fudge factors for nroff and troff
.if n \{\
.	ds #H 0
.	ds #V .8m
.	ds #F .3m
.	ds #[ \f1
.	ds #] \fP
.\}
.if t \{\
.	ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.	ds #V .6m
.	ds #F 0
.	ds #[ \&
.	ds #] \&
.\}
.	\" simple accents for nroff and troff
.if n \{\
.	ds ' \&
.	ds ` \&
.	ds ^ \&
.	ds , \&
.	ds ~ ~
.	ds ? ?
.	ds ! !
.	ds /
.	ds q
.\}
.if t \{\
.	ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.	ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.	ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.	ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.	ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.	ds ? \s-2c\h'-\w'c'u*7/10'\u\h'\*(#H'\zi\d\s+2\h'\w'c'u*8/10'
.	ds ! \s-2\(or\s+2\h'-\w'\(or'u'\v'-.8m'.\v'.8m'
.	ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.	ds q o\h'-\w'o'u*8/10'\s-4\v'.4m'\z\(*i\v'-.4m'\s+4\h'\w'o'u*8/10'
.\}
.	\" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds v \\k:\h'-(\\n(.wu*9/10-\*(#H)'\v'-\*(#V'\*(#[\s-4v\s0\v'\*(#V'\h'|\\n:u'\*(#]
.ds _ \\k:\h'-(\\n(.wu*9/10-\*(#H+(\*(#F*2/3))'\v'-.4m'\z\(hy\v'.4m'\h'|\\n:u'
.ds . \\k:\h'-(\\n(.wu*8/10)'\v'\*(#V*4/10'\z.\v'-\*(#V*4/10'\h'|\\n:u'
.ds 3 \*(#[\v'.2m'\s-2\&3\s0\v'-.2m'\*(#]
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.ds oe o\h'-(\w'o'u*4/10)'e
.ds Oe O\h'-(\w'O'u*4/10)'E
.	\" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.	\" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.	ds : e
.	ds 8 ss
.	ds v \h'-1'\o'\(aa\(ga'
.	ds _ \h'-1'^
.	ds . \h'-1'.
.	ds 3 3
.	ds o a
.	ds d- d\h'-1'\(ga
.	ds D- D\h'-1'\(hy
.	ds th \o'bp'
.	ds Th \o'LP'
.	ds ae ae
.	ds Ae AE
.	ds oe oe
.	ds Oe OE
.\}
.rm #[ #] #H #V #F C
.SH "NAME"
Mail::Sendmail v. 0.77 \- Simple platform independent mailer
.SH "SYNOPSIS"
.PP
.Vb 1
\&  use Mail::Sendmail;
.Ve
.Vb 4
\&  %mail = ( To      => 'you@there.com',
\&            From    => 'me@here.com',
\&            Message => "This is a very short message"
\&           );
.Ve
.Vb 1
\&  sendmail(%mail) or die $Mail::Sendmail::error;
.Ve
.Vb 1
\&  print "OK. Log says:\en", $Mail::Sendmail::log;
.Ve
.SH "DESCRIPTION"
Simple platform independent e-mail from your perl script. Only requires
Perl 5 and a network connection.
.PP
After struggling for some time with various command-line mailing programs
which never did exactly what I wanted, I put together this Perl only
solution.
.PP
Mail::Sendmail contains mainly &sendmail, which takes a hash with the
message to send and sends it. It is intended to be very easy to setup and
use.
.SH "INSTALLATION"
.Ip "Best" 4
perl \-\s-1MCPAN\s0 \-e \*(L"install Mail::Sendmail\*(R"
.Ip "Traditional" 4
.Sp
.Vb 4
\&    perl Makefile.PL
\&    make
\&    make test
\&    make install
.Ve
.Ip "Manual" 4
Copy Sendmail.pm to Mail/ in your Perl lib directory.
.Sp
.Vb 3
\&    (eg. c:\ePerl\elib\eMail\e, c:\ePerl\esite\elib\eMail\e,
\&     /usr/lib/perl5/site_perl/Mail/, ... or whatever it
\&     is on your system)
.Ve
.Ip "ActivePerl's \s-1PPM\s0" 4
ppm install --location=http://alma.ch/perl/ppm Mail-Sendmail
.Sp
But this way you don't get a chance to have a look at other files (Changes, 
Todo, test.pl, ...) and \s-1PPM\s0 doesn't run the test script (test.pl).
.PP
At the top of Sendmail.pm, set your default \s-1SMTP\s0 server, unless you specify
it with each message, or want to use the default.
.PP
Install \s-1MIME::\s0QuotedPrint. This is not required but strongly recommended.
.SH "FEATURES"
Automatic time zone detection, Date: header, MIME quoted-printable encoding 
(if MIME::QuotedPrint installed), all of which can be overridden.
.PP
Internal Bcc: and Cc: support (even on broken servers)
.PP
Allows real names in From: and To: fields
.PP
Doesn't send unwanted headers, and allows you to send any \fIheader\fR\|(s) you
want
.PP
Configurable retries and use of alternate servers if your mail server is
down
.PP
Good plain text error reporting
.SH "LIMITATIONS"
Headers are not encoded, even if they have accented characters.
.PP
Since the whole message is in memory (twice!), it's not suitable for 
sending very big attached files.
.PP
The SMTP server has to be set manually in Sendmail.pm or in your script,
unless you can live with the default (localhost or Compuserve's
smpt.site1.csi.com).
.SH "CONFIGURATION"
.Ip "Default \s-1SMTP\s0 server(s)" 4
This is probably all you want to configure. It is usually done through
\fI$mailcfg{smtp}\fR, which you can edit at the top of the Sendmail.pm file.
This is a reference to a list of \s-1SMTP\s0 servers. You can also set it from
your script:
.Sp
\f(CWunshift @{$Mail::Sendmail::mailcfg{'smtp'}} , 'my.mail.server';\fR
.Sp
Alternatively, you can specify the server in the \fI%mail\fR hash you send
from your script, which will do the same thing:
.Sp
\f(CW$mail{smtp} = 'my.mail.server';\fR
.Sp
A future version will try to set useful defaults for you during the
Makefile.\s-1PL\s0.
.Ip "Other configuration settings" 4
See \fI%mailcfg\fR under the section on \fI\s-1DETAILS\s0\fR below for other configuration options.
.SH "DETAILS"
.Sh "\fIsendmail()\fR"
sendmail is the only thing exported to your namespace by default
.PP
\f(CWsendmail(%mail) || print "Error sending mail: $Mail::Sendmail::error\en";\fR
.PP
It takes a hash containing the full message, with keys for all headers,
body, and optionally for another non-default \s-1SMTP\s0 server and/or port.
.PP
It returns 1 on success or 0 on error, and rewrites
\f(CW$Mail::Sendmail::error\fR and \f(CW$Mail::Sendmail::log\fR.
.PP
Keys are \s-1NOT\s0 case-sensitive.
.PP
The colon after headers is not necessary.
.PP
The Body part key can be called \*(L'Body\*(R', \*(L'Message\*(R' or \*(L'Text\*(R'. The \s-1SMTP\s0
server key can be called \*(L'Smtp\*(R' or \*(L'Server\*(R'.
.PP
The following headers are added unless you specify them yourself:
.PP
.Vb 2
\&    Mime-version: 1.0
\&    Content-type: 'text/plain; charset="iso-8859-1"'
.Ve
.Vb 3
\&    Content-transfer-encoding: quoted-printable
\&    or (if MIME::QuotedPrint not installed)
\&    Content-transfer-encoding: 8bit
.Ve
.Vb 1
\&    Date: [string returned by time_to_date()]
.Ve
The following are not exported by default, but you can still access them
with their full name, or request their export on the use line like in:
\f(CWuse Mail::Sendmail qw($address_rx time_to_date);\fR
.Sh "\fIMail::Sendmail::time_to_date()\fR"
convert time ( as from \f(CWtime()\fR ) to an \s-1RFC\s0 822 compliant string for the
Date header. See also the section on \fI%Mail::Sendmail::mailcfg\fR.
.Sh "\f(CW$Mail::Sendmail::error\fR"
When you don't run with the \fB\-w\fR flag, the module sends no errors to
\s-1STDERR\s0, but puts anything it has to complain about in here. You should
probably always check if it says something.
.Sh "\f(CW$Mail::Sendmail::log\fR"
A summary that you could write to a log file after each send
.Sh "\f(CW$Mail::Sendmail::address_rx\fR"
A handy regex to recognize e-mail addresses.
.PP
A correct regex for valid e-mail addresses was written by one of the judges
in the obfuscated Perl contest... :\-) It is quite big. This one is an
attempt to a reasonable compromise, and should accept all real-world
internet style addresses. The domain part is required and comments or
characters that would need to be quoted are not supported.
.PP
.Vb 7
\&  Example:
\&    $rx = $Mail::Sendmail::address_rx;
\&    if (/$rx/) {
\&      $address=$1;
\&      $user=$2;
\&      $domain=$3;
\&    }
.Ve
.Sh "\f(CW%Mail::Sendmail::mailcfg\fR"
This hash contains all configuration options. You normally edit it once (if
ever) in Sendmail.pm and forget about it, but you could also access it from
your scripts. For readability, I'll assume you have imported it.
.PP
The keys are not case-sensitive: they are all converted to lowercase before
use. Writing \f(CW$mailcfg{Port} = 2525;\fR is \s-1OK\s0: the default \f(CW$mailcfg\fR{port}
(25) will be deleted and replaced with your new value of 2525.
.Ip "$mailcfg{smtp}" 4
\f(CW$mailcfg{smtp} = [qw(localhost smtp.site1.csi.com)];\fR
.Sp
This is a reference to a list of smtp servers, so if your main server is
down, the module tries the next one. If one of your servers uses a special
port, add it to the server name with a colon in front, to override the
default port (like in my.special.server:2525).
.Sp
Default: localhost and smtp.site1.csi.com (which seems to be an open relay)
.Ip "$mailcfg{from}" 4
\f(CW$mailcfg{from} = 'Mailing script me@mydomain.com';\fR
.Sp
From address used if you don't supply one in your script. Should not be of
type \*(L'user@localhost\*(R' since that may not be valid on the recipient's
host.
.Sp
Default: undefined.
.Ip "$mailcfg{mime}" 4
\f(CW$mailcfg{mime} = 1;\fR
.Sp
Set this to 0 if you don't want any automatic \s-1MIME\s0 encoding. You normally
don't need this, the module should \*(L'Do the right thing\*(R' anyway.
.Sp
Default: 1;
.Ip "$mailcfg{retries}" 4
\f(CW$mailcfg{retries} = 1;\fR
.Sp
How many times should the connection to the same \s-1SMTP\s0 server be retried in
case of a failure.
.Sp
Default: 1;
.Ip "$mailcfg{delay}" 4
\f(CW$mailcfg{delay} = 1;\fR
.Sp
Number of seconds to wait between retries. This delay also happens before
trying the next server in the list, if the retries for the current server
have been exhausted. For \s-1CGI\s0 scripts, you want few retries and short delays
to return with a results page before the http connection times out. For
unattended scripts, you may want to use many retries and long delays to
have a good chance of your mail being sent even with temporary failures on
your network.
.Sp
Default: 1 (second);
.Ip "$mailcfg{tz}" 4
\f(CW$mailcfg{tz} = '+0800';\fR
.Sp
Normally, your time zone is set automatically, from the difference between
\f(CWtime()\fR and \f(CWgmtime()\fR. This allows you to override automatic detection
in cases where your system is confused (such as some Win32 systems in zones
which do not use daylight savings time: see Microsoft \s-1KB\s0 article Q148681)
.Sp
Default: undefined (automatic detection at run-time).
.Ip "$mailcfg{port}" 4
\f(CW$mailcfg{port} = 25;\fR
.Sp
Port used when none is specified in the server name.
.Sp
Default: 25.
.Ip "$mailcfg{debug}" 4
\f(CW$mailcfg{debug} =\fR 0;>
.Sp
Prints stuff to \s-1STDERR\s0. Not used much, and what is printed may change
without notice. Don't count on it.
.Sp
Default: 0;
.Sh "\f(CW$Mail::Sendmail::VERSION\fR"
The package version number (you can not import this one)
.Sh "Configuration variables from previous versions"
The following global variables were used in version 0.74 for configuration. They should still work, but will not in a future version (unless you complain loudly). Please use \fI%mailcfg\fR if you need to access the configuration from your scripts.
.Ip "$Mail::Sendmail::default_smtp_server" 4
.Ip "$Mail::Sendmail::default_smtp_port" 4
.Ip "$Mail::Sendmail::default_sender" 4
.Ip "$Mail::Sendmail::\s-1TZ\s0" 4
.Ip "$Mail::Sendmail::connect_retries" 4
.Ip "$Mail::Sendmail::retry_delay" 4
.Ip "$Mail::Sendmail::use_MIME" 4
This one couldn't really be used in the previous version, so I just dropped it.
It is replaced by \fI$mailcfg{mime}\fR which works.
.SH "ANOTHER EXAMPLE"
.PP
.Vb 1
\&  use Mail::Sendmail;
.Ve
.Vb 3
\&  print "Testing Mail::Sendmail version $Mail::Sendmail::VERSION\en";
\&  print "Default server: $Mail::Sendmail::mailcfg{smtp}->[0]\en";
\&  print "Default sender: $Mail::Sendmail::mailcfg{from}\en";
.Ve
.Vb 10
\&  %mail = (
\&      #To      => 'No to field this time, only Bcc and Cc',
\&      #From    => 'not needed, use default',
\&      Bcc     => 'Someone <him@there.com>, Someone else her@there.com',
\&      # only addresses are extracted from Bcc, real names disregarded
\&      Cc      => 'Yet someone else <xz@whatever.com>',
\&      # Cc will appear in the header. (Bcc will not)
\&      Subject => 'Test message',
\&      'X-Mailer' => "Mail::Sendmail version $Mail::Sendmail::VERSION",
\&  );
.Ve
.Vb 5
\&  $mail{Smtp} = 'special_server.for-this-message-only.domain.com';
\&  $mail{'X-custom'} = 'My custom additionnal header';
\&  $mail{'mESSaGE : '} = "The message key looks terrible, but works.";
\&  # cheat on the date:
\&  $mail{Date} = Mail::Sendmail::time_to_date( time() - 86400 ),
.Ve
.Vb 2
\&  if (sendmail %mail) { print "Mail sent OK.\en" }
\&  else { print "Error sending mail: $Mail::Sendmail::error \en" }
.Ve
.Vb 1
\&  print "\en\e$Mail::Sendmail::log says:\en", $Mail::Sendmail::log;
.Ve
.SH "CHANGES"
Many changes and bug-fixes since version 0.74. In short: less code, more 
functionality and docs. See the \fIChanges\fR file.
.SH "AUTHOR"
Milivoj Ivkovic mi@alma.ch or ivkovic@csi.com
.SH "NOTES"
MIME::QuotedPrint is used by default on every message if available. It 
allows reliable sending of accented characters, and also takes care of 
too long lines (which can happen in HTML mails). It is available in the 
MIME\-Base64 package at http://www.perl.com/CPAN/modules/by-module/MIME/ or 
through PPM.
.PP
Look at http://alma.ch/perl/Mail-Sendmail-FAQ.htm for additional info 
(CGI, examples of sending attachments, HTML mail etc...)
.PP
You can use it freely. (Someone complained this is too vague. So, more
precisely: do whatever you want with it, but be warned that terrible things
will happen to you if you use it badly, like for sending spam, claiming you
wrote it alone, or ...?)
.PP
I would appreciate a short (or long) e-mail note if you use this (and even
if you don't, especially if you care to say why). And of course,
bug-reports and/or suggestions are welcome.
.PP
Last revision: 27.03.99. Latest version should be available at
http://alma.ch/perl/mail.htm , and a few days later on CPAN.

.rn }` ''
.IX Title "Sendmail 3"
.IX Name "Mail::Sendmail v. 0.77 - Simple platform independent mailer"

.IX Header "NAME"

.IX Header "SYNOPSIS"

.IX Header "DESCRIPTION"

.IX Header "INSTALLATION"

.IX Item "Best"

.IX Item "Traditional"

.IX Item "Manual"

.IX Item "ActivePerl's \s-1PPM\s0"

.IX Header "FEATURES"

.IX Header "LIMITATIONS"

.IX Header "CONFIGURATION"

.IX Item "Default \s-1SMTP\s0 server(s)"

.IX Item "Other configuration settings"

.IX Header "DETAILS"

.IX Subsection "\fIsendmail()\fR"

.IX Subsection "\fIMail::Sendmail::time_to_date()\fR"

.IX Subsection "\f(CW$Mail::Sendmail::error\fR"

.IX Subsection "\f(CW$Mail::Sendmail::log\fR"

.IX Subsection "\f(CW$Mail::Sendmail::address_rx\fR"

.IX Subsection "\f(CW%Mail::Sendmail::mailcfg\fR"

.IX Item "$mailcfg{smtp}"

.IX Item "$mailcfg{from}"

.IX Item "$mailcfg{mime}"

.IX Item "$mailcfg{retries}"

.IX Item "$mailcfg{delay}"

.IX Item "$mailcfg{tz}"

.IX Item "$mailcfg{port}"

.IX Item "$mailcfg{debug}"

.IX Subsection "\f(CW$Mail::Sendmail::VERSION\fR"

.IX Subsection "Configuration variables from previous versions"

.IX Item "$Mail::Sendmail::default_smtp_server"

.IX Item "$Mail::Sendmail::default_smtp_port"

.IX Item "$Mail::Sendmail::default_sender"

.IX Item "$Mail::Sendmail::\s-1TZ\s0"

.IX Item "$Mail::Sendmail::connect_retries"

.IX Item "$Mail::Sendmail::retry_delay"

.IX Item "$Mail::Sendmail::use_MIME"

.IX Header "ANOTHER EXAMPLE"

.IX Header "CHANGES"

.IX Header "AUTHOR"

.IX Header "NOTES"

