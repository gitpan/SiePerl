.\" Automatically generated by Pod::Man version 1.15
.\" Mon Apr 23 12:02:12 2001
.\"
.\" Standard preamble:
.\" ======================================================================
.de Sh \" Subsection heading
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Ip \" List item
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R

.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  | will give a
.\" real vertical bar.  \*(C+ will give a nicer C++.  Capital omega is used
.\" to do unbreakable dashes and therefore won't be available.  \*(C` and
.\" \*(C' expand to `' in nroff, nothing in troff, for use with C<>
.tr \(*W-|\(bv\*(Tr
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" If the F register is turned on, we'll generate index entries on stderr
.\" for titles (.TH), headers (.SH), subsections (.Sh), items (.Ip), and
.\" index entries marked with X<> in POD.  Of course, you'll have to process
.\" the output yourself in some meaningful fashion.
.if \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.\"
.\" For nroff, turn off justification.  Always turn off hyphenation; it
.\" makes way too many mistakes in technical documents.
.hy 0
.if n .na
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.bd B 3
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ======================================================================
.\"
.IX Title "MASON 1"
.TH MASON 1 "perl v5.6.1" "2001-01-05" "User Contributed Perl Documentation"
.UC
.SH "NAME"
Mason \- High-performance, dynamic web site authoring system 
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 8
\&    # Directives for your Apache config files.
\&    # Route all requests to the Mason handler.
\&    #
\&    PerlRequire /opt/mason/eg/handler.pl
\&    <Location />
\&        SetHandler perl-script
\&        PerlHandler HTML::Mason
\&    </Location>
.Ve
.Vb 7
\&    # Sample handler.pl file.
\&    # Start Mason and define the mod_perl handler routine.
\&    #
\&    package HTML::Mason;
\&    use HTML::Mason;
\&    use HTML::Mason::ApacheHandler;
\&    use strict;
.Ve
.Vb 7
\&    my $parser = new HTML::Mason::Parser;
\&    my $interp = new HTML::Mason::Interp (parser=>$parser,
\&                                   comp_root=>'/opt/www/htdocs',
\&                                   data_dir=>'/opt/mason/data');
\&    my $ah = new HTML::Mason::ApacheHandler (interp=>$interp);
\&    chown ( [getpwnam('nobody')]->[2], [getgrnam('nobody')]->[2],
\&            $interp->files_written );   # chown nobody
.Ve
.Vb 5
\&    sub handler
\&    {
\&        my ($r) = @_;
\&        $ah->handle_request($r);
\&    }
.Ve
.Vb 1
\&    1;
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
Mason is a tool for building, serving and managing large web
sites. Its features make it an ideal backend for high load sites
serving dynamic content, such as online newspapers or database driven
e-commerce sites.
.PP
Mason's various pieces revolve around the notion of \*(L"components''. A
component is a mix of \s-1HTML\s0, Perl, and special Mason commands, one
component per file. So-called \*(R"top-level" components represent entire
web-pages, while smaller components typically return \s-1HTML\s0 snippets for
embedding in top-level components. This object-like architecture
greatly simplifies site maintenance: change a shared component, and
you instantly changed all dependant pages that refer to it across a
site (or across many virtual sites).
.PP
Mason's component syntax lets designers separate a web page into
programmatic and design elements. This means the esoteric Perl bits
can be hidden near the bottom of a component, preloading simple
variables for use above in the \s-1HTML\s0. In our own experience, this frees
content managers (i.e., non-programmers) to work on the layout without
getting mired in programming details. Techies, however, still enjoy
the full power of Perl.
.PP
One of the best ways to learn about Mason is to explore the samples/
directory created during installation. There you will find a
collection of components, simple to complex, illustrating most of
Mason's component syntax.
.PP
Other Mason features include: 
.Ip "Caching" 4
.IX Item "Caching"
Mason caches components after compilation, and offers an internal,
shared, expireable data cache for use by components themselves.
.Ip "Debugging" 4
.IX Item "Debugging"
Mason includes a debugging mode whereby \s-1HTTP\s0 requests can be captured
to \*(L"debug files\*(R" for later replay inside Perl's command-line debugger
(as opposed to the non-interactive mod_perl interpreter).
.Ip "Templating" 4
.IX Item "Templating"
The autohandler and dhandler features make it easy to apply a common
header, footer, or filtering function to an entire directory or
hierarchy of pages.
.Ip "Previewer" 4
.IX Item "Previewer"
Mason includes a powerful previewing utility which acts as a proxy
between Mason and incoming requests. Using a web interface, users
create \*(L"port profiles\*(R" that massage requests in all kinds of
interesting ways: different browsers may be simulated, different
request ports, different times of day, etc.
.Ip "Standalone Use" 4
.IX Item "Standalone Use"
Mason is optimized for use with mod_perl, but can also be used from
\&\s-1CGI\s0 or as a standalone tool to generate other types of dynamic text
files (similar to Text::Template, ePerl, etc.). To learn more about
this option see the \s-1STANDALONE\s0 \s-1MODE\s0 section in
\&\fB\s-1HTML:\s0:Mason::Interp\fR.
.PP
Mason works by intercepting innocent-looking requests (say,
http://www.yoursite.com/index.html) and mapping them to requests for
Mason components.  Mason then compiles the component, runs it, and
feeds the output back to the client.
.PP
Consider this simple Mason component:
.PP
.Vb 3
\&    % my $noun = 'World';
\&    Hello <% $noun %>!
\&    How are ya?
.Ve
The output of this component is: 
.PP
.Vb 2
\&    Hello World!
\&    How are ya?
.Ve
In this component you see a mix of standard \s-1HTML\s0 and Mason
elements. The bare '%' prefixing the first line tells Mason that this
is a line of Perl code. One line below, the embedded <%\ ...\ %> tag gets replaced with the return value of its contents,
evaluated as a Perl expression.
.PP
Beyond this trivial example, components can also embed serious chunks
of Perl code (say, to pull records from a database). They can also
call other components, cache results for later reuse, and perform all
the tricks you expect from a regular Perl program. See
\&\fB\s-1HTML:\s0:Mason::Devel\fR for a full tutorial on building, using and
debugging Mason components.
.SH "INSTALLATION"
.IX Header "INSTALLATION"
Mason has been tested under Linux, FreeBSD, Solaris, \s-1HPUX\s0, and
Win32. As an all-Perl solution, it should work on any machine that has
working versions of Perl 5.004+, mod_perl, and the required \s-1CPAN\s0
modules.
.PP
Mason has a standard MakeMaker-driven installation. See the \s-1README\s0
file for details.
.SH "CONFIGURING MASON"
.IX Header "CONFIGURING MASON"
Mason's configuration depends on two files: your Apache \f(CW\*(C`conf\*(C'\fR files
(\f(CW\*(C`httpd.conf\*(C'\fR or \f(CW\*(C`srm.conf\*(C'\fR), into which you insert directives to
activate Mason's request handler, and Mason's \f(CW\*(C`handler.pl\*(C'\fR file which
runs at Apache startup. \f(CW\*(C`handler.pl\*(C'\fR does two things: it starts up
Mason (which then runs persistently within the httpd), and it defines
a handler routine to receive \s-1HTTP\s0 requests.
.PP
The paragraphs below assume some knowledge of mod_perl, Apache
configuration details, and the Apache request \s-1API\s0. If you're rusty on
any these topics, bone up by reading the documentation available at
http://www.apache.org (Apache) and http://perl.apache.org
(mod_perl). Here you will also find subscription details for the
mod_perl mailing list\*(--in my view the best mod_perl resource around.
.Sh "Single Site Configuration"
.IX Subsection "Single Site Configuration"
The simplest Mason component is one composed of pure \s-1HTML\s0, so the fast
track is simply to attach Mason to some branch of your server's
DocumentRoot, like so:
.PP
.Vb 2
\&    # Additions to your httpd.conf
\&    PerlRequire /usr/local/mason/handler.pl
.Ve
.Vb 5
\&    Alias /mason /usr/local/www/htdocs
\&    <Location /mason>
\&        SetHandler perl-script
\&        PerlHandler HTML::Mason
\&    </Location>
.Ve
These directives tell Apache to first run \f(CW\*(C`handler.pl\*(C'\fR, the Mason
startup file. The \*(L"Alias\*(R" then maps any \*(L"/mason\*(R" URLs into the
DocumentRoot (assuming the DocumentRoot is /usr/local/www/htdocs).
Finally, the <Location> directive routes those requests to the handler
routine \f(CW\*(C`HTML::Mason::handler\*(C'\fR.
.PP
If you want to create \s-1HTML\s0 without necessarily using the .html extension,
change your DefaultType:
.PP
.Vb 1
\&    DefaultType text/html
.Ve
and make sure mod_mime_magic is not active.
.PP
That's it for the Apache configuration. Next you will need to
configure Mason's \f(CW\*(C`handler.pl\*(C'\fR file, a sample of which is in
\&\f(CW\*(C`eg/handler.pl\*(C'\fR in the Mason distribution. Here you must make
some decisions:
.Ip "Where is the component root (comp_root)?" 4
.IX Item "Where is the component root (comp_root)?"
Mason introduces the idea of a \*(L"component root\*(R" which, like the
DocumentRoot, is a virtual root for the component filesystem. In this
example we equate the two roots; other configurations will opt to keep
them separate.
.Ip "Where is the data directory (data_dir)?" 4
.IX Item "Where is the data directory (data_dir)?"
Mason generates various data files, which live in topical directories
under Mason's \*(L"data directory\*(R".
.Ip "What is the \s-1UID\s0 and \s-1GID\s0 that the server runs under?" 4
.IX Item "What is the UID and GID that the server runs under?"
If your web server is running on a privileged port like 80, the parent
process runs as root and spawns children under the 'User' and 'Group'
IDs listed in your \f(CW\*(C`httpd.conf\*(C'\fR. To prevent ownership and permission
conflicts, set the \fIchown()\fR parameters to match the \s-1UID\s0 and \s-1GID\s0 from
your \f(CW\*(C`httpd.conf\*(C'\fR. See the \f(CW\*(C`handler\*(C'\fR section in the
\&\fIAdministrator's Guide\fR guide for details.
.Ip "Do you plan to intermix images and components in the same directory?" 4
.IX Item "Do you plan to intermix images and components in the same directory?"
If you use a <Location> or <Directory> directive like the one suggested above,
then requests to any file under that directory will go to the Mason
handler. If there are images in the directory, Mason will try to treat
them like regular components. This is bad: not only is there extra
overhead, but if an image inadvertently contains a Mason character
sequence such as \*(L"<%\*(R", Mason will try to interpret that piece and fail
with a syntax error.
.Sp
The simplest remedy is to have Mason decline image and other non-HTML requests, thus
letting Apache serve them in the normal way.  The following line
.Sp
.Vb 1
\&    return -1 if $r->content_type && $r->content_type !~ m|^text/|i;
.Ve
declines all requests with a content type not starting with \*(L"text/\*(R".
This allows text/html and text/plain to pass through but not much else.
It is included (commented out) in the default handler.pl.
.Ip "Are you running with taint checks (e.g. PerlTaintCheck)?" 4
.IX Item "Are you running with taint checks (e.g. PerlTaintCheck)?"
If so, pass the flag \f(CW\*(C`taint_check\*(C'\fR=>1 when creating the parser; this
tells Mason to untaint component code and filenames.
.PP
Both comp_root and the data_dir are set when Mason creates a new
Interp object:
.PP
.Vb 3
\&    my $interp = new HTML::Mason::Interp (parser=>$parser,
\&                    comp_root=>'/usr/local/www/htdocs'
\&                    data_dir=>'/usr/local/mason/');
.Ve
Set these to your own locations, then restart the server and go to
some standard \s-1URL\s0 on your site, prefixing the \s-1URL\s0 with \*(L"/mason\*(R". If
all goes well you should see the same page as without the \*(L"/mason\*(R"
prefix. If not, recheck your Apache config files and \f(CW\*(C`handler.pl\*(C'\fR,
and also tail your server's error log.
.PP
If you are getting erroneous \*(L"404 Not Found\*(R" errors, Mason may be
having trouble with your document and component root. Remember that
all files handled by Mason must fall underneath the component root.
One situation that will unfortunately confuse Mason is if your
document or component root goes through a soft link. Try specifying
your document and component root settings in terms of the true path.
.PP
Assuming it worked, you now have a Mason \*(L"lens\*(R" through which to view
your \s-1HTML\s0 tree. Try adding a Mason tag to some \s-1HTML\s0 file, say <% 2+2
%>. If you hit Reload and see a \*(L"4\*(R", Mason's up and running. You can
now copy or link the \f(CW\*(C`samples/\*(C'\fR directory into your new comp_root and
check out the sample components in your browser.
.PP
Once you feel comfortable with Mason, you can \*(L"fully\*(R" install it by
deleting the \*(L"Alias\*(R" directive from your httpd.conf, and changing the
<Location> mapping from \*(L"/mason\*(R" to just \*(L"/\*(R". Now all URLs serve
through Mason. If you want to maintain a few directories that 
don't serve through Mason (e.g. for images), you can put in overrides
like so:
.PP
.Vb 3
\&    <Location /plain>
\&            SetHandler default-handler
\&    </Location>
.Ve
\&\fB\s-1HTML:\s0:Mason::Admin\fR describes how to configure Mason to work with
multiple virtual servers on the same box.
.SH "DOCUMENTATION ROADMAP"
.IX Header "DOCUMENTATION ROADMAP"
Once Mason is on its feet, the next step is to write a component or
two. The \fIMason Developer's Manual\fR (\fB\s-1HTML:\s0:Mason::Devel\fR) 
is a complete tutorial for writing, using, and debugging components. A
reference companion to the Developer's Manual is the Request \s-1API\s0
documentation, \fB\s-1HTML:\s0:Mason::Request\fR.
.PP
Whoever is responsible for setting up and tuning Mason should read the
\&\fIAdministrator's Manual\fR (\fB\s-1HTML:\s0:Mason::Admin\fR).  Details of
Mason's core modules can be found in \fB\s-1HTML:\s0:Mason::Parser\fR,
\&\fB\s-1HTML:\s0:Mason::Interp\fR, and \fB\s-1HTML:\s0:Mason::ApacheHandler\fR.
.PP
Most of this documentation assumes that you're running Mason on top of
mod_perl, since that is the most common configuration.  If you are
using Mason outside of mod_perl, the documentation is still valid;
you'll just have to ignore mod_perl specific references like \f(CW$r\fR and
the ApacheHandler object, and you'll want to read the \s-1STANDALONE\s0 \s-1MODE\s0 section in
\&\fB\s-1HTML:\s0:Mason::Interp\fR.
.SH "AUTHOR"
.IX Header "AUTHOR"
Jonathan Swartz, swartz@pobox.com 
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\s-1HTML:\s0:Mason::Components,
\&\s-1HTML:\s0:Mason::Request,
\&\s-1HTML:\s0:Mason::Parser,
\&\s-1HTML:\s0:Mason::Interp,
\&\s-1HTML:\s0:Mason::ApacheHandler
